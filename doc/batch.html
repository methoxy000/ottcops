<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Batch Analysis Â· OPENCORE Analyzer</title>
    <style>
      body {
        font-family: "Space Grotesk", system-ui, sans-serif;
        margin: 0 auto;
        max-width: 960px;
        padding: 2.5rem;
        line-height: 1.6;
      }
      header {
        border-bottom: 2px solid #0f172a;
        margin-bottom: 2rem;
      }
      pre {
        background: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
      }
      nav a {
        margin-right: 1rem;
        color: #0d5c63;
        text-decoration: none;
        font-weight: 600;
      }
      li { margin-bottom: 0.5rem; }
    </style>
  </head>
  <body>
    <header>
      <h1>Batch Analysis</h1>
      <p>Upload multiple images in one go. The backend processes each file and returns a summary plus per-image details.</p>
      <nav>
        <a href="/doc/index.html">Back to index</a>
        <a href="/doc/debug.html">Debug Mode</a>
      </nav>
    </header>

    <section>
      <h2>How it works</h2>
      <ol>
        <li>Enable <strong>multiple</strong> on the file picker or drop several images into the dropzone.</li>
        <li>Review the thumbnails in the preview tray (click to zoom if needed).</li>
        <li>Choose your ML model and LLM profile, then click <em>Analyze</em>.</li>
        <li>The UI posts everything to <code>/api/opencore/analyze-batch</code> and renders the summary plus a tab per image.</li>
      </ol>
    </section>

    <section>
      <h2>API</h2>
      <p>Endpoint: <code>POST /api/opencore/analyze-batch</code> (multipart/form-data)</p>
      <pre><code>curl -X POST http://localhost:8000/api/opencore/analyze-batch \ 
  -F "modelId=builtin" \ 
  -F "prompt=Please describe trichome maturity" \ 
  -F "files[]=@sample1.jpg" \ 
  -F "files[]=@sample2.jpg"</code></pre>
      <p>Example response:</p>
      <pre><code>{
  "status": "ok",
  "summary": { "text": "Overall assessment of all images" },
  "items": [
    {
      "image_id": "sample1.jpg",
      "analysis": { "ml": { ... }, "llm": { ... } },
      "debug": { "request_id": "...", "timings": { "total_ms": 1420 } }
    },
    {
      "image_id": "sample2.jpg",
      "analysis": { "ml": { ... }, "llm": { ... } }
    }
  ]
}</code></pre>
    </section>

    <section>
      <h2>Error handling</h2>
      <ul>
        <li>Large files: the API will reject payloads that exceed the server size limits.</li>
        <li>No files selected: the UI blocks the request and shows a toast.</li>
        <li>Timeouts: check the debug panel; camera streams can be slow, especially with large models.</li>
      </ul>
    </section>
  </body>
</html>
